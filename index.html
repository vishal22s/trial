<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Simple PDF Watermark</title>
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
</style>
</head>
<body>

<h2>Upload PDF & Add Watermark</h2>
<input type="file" id="fileInput" accept="application/pdf" />
<br/><br/>

<label>
  Watermark mode:
  <select id="wmMode">
    <option value="none">None</option>
    <option value="pageNumbers">Page Numbers</option>
    <option value="customSame">Same Custom Text</option>
  </select>
</label>
<br/><br/>
<label>
  Custom Text:
  <input type="text" id="customText" disabled placeholder="Enter watermark text" />
</label>
<br/><br/>
<button id="processBtn" disabled>Generate Watermarked PDF</button>
<br/><br/>
<a id="downloadLink" style="display:none" download="watermarked.pdf">Download Watermarked PDF</a>

<script>
  const fileInput = document.getElementById('fileInput');
  const wmMode = document.getElementById('wmMode');
  const customText = document.getElementById('customText');
  const processBtn = document.getElementById('processBtn');
  const downloadLink = document.getElementById('downloadLink');

  let pdfBytes = null;

  fileInput.addEventListener('change', async () => {
    if (fileInput.files.length === 0) return;
    pdfBytes = await fileInput.files[0].arrayBuffer();
    processBtn.disabled = false;
    downloadLink.style.display = 'none';
  });

  wmMode.addEventListener('change', () => {
    customText.disabled = wmMode.value !== 'customSame';
  });

  processBtn.addEventListener('click', async () => {
    if (!pdfBytes) return alert('Upload PDF first!');
    const { PDFDocument, rgb, StandardFonts } = PDFLib;
    const pdfDoc = await PDFDocument.load(pdfBytes);
    const pages = pdfDoc.getPages();
    const font = await pdfDoc.embedFont(StandardFonts.HelveticaBold);

    for (let i = 0; i < pages.length; i++) {
      const page = pages[i];
      const { width, height } = page.getSize();

      let text = '';
      if (wmMode.value === 'pageNumbers') {
        text = `Page ${i + 1}`;
      } else if (wmMode.value === 'customSame') {
        text = customText.value.trim();
        if (!text) continue;
      } else {
        continue; // none mode, skip watermark
      }

      const fontSize = 36;
      const textWidth = font.widthOfTextAtSize(text, fontSize);
      const textHeight = fontSize;

      // Draw centered watermark with low opacity
      page.drawText(text, {
        x: (width - textWidth) / 2,
        y: (height - textHeight) / 2,
        size: fontSize,
        font,
        color: rgb(0.75, 0, 0),
        opacity: 0.3,
        rotate: PDFLib.degrees(-45),
      });
    }

    const newPdfBytes = await pdfDoc.save();
    const blob = new Blob([newPdfBytes], { type: 'application/pdf' });
    const url = URL.createObjectURL(blob);
    downloadLink.href = url;
    downloadLink.style.display = 'inline-block';
  });
</script>

</body>
</html>